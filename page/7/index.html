<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="GaoQ's blog" />





  <link rel="alternate" href="/atom.xml" title="GaoQ's blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description" content="There are no shortcuts to any place worth going">
<meta property="og:type" content="website">
<meta property="og:title" content="GaoQ&#39;s blog">
<meta property="og:url" content="http://gaoquan.wang/page/7/index.html">
<meta property="og:site_name" content="GaoQ&#39;s blog">
<meta property="og:description" content="There are no shortcuts to any place worth going">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="GaoQ&#39;s blog">
<meta name="twitter:description" content="There are no shortcuts to any place worth going">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> GaoQ's blog - There are no shortcuts to any place worth going </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?b902fa08b28044c55da6c70921955ecb";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>


<a href="https://github.com/GaoQ1"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/8b6b8ccc6da3aa5722903da7b58eb5ab1081adee/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png"></a>


    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">GaoQ's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">There are no shortcuts to any place worth going</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
            关于我
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/16/语法和数据类型/" itemprop="url">
                  语法和数据类型
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-16T10:13:21+08:00" content="2016-05-16">
              2016-05-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/笔记/" itemprop="url" rel="index">
                    <span itemprop="name">笔记</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/16/语法和数据类型/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/16/语法和数据类型/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>By plucking her petals you do not gather the beauty of the flower. </p>
<p>本章讨论Javascript的基本语法(basic grammar)，变量声明(variable declarations)，数据类型(data types)和字面量(literals)。</p>
</blockquote>
<h2 id="基础知识-Basic"><a href="#基础知识-Basic" class="headerlink" title="基础知识(Basic)"></a>基础知识(Basic)</h2><p>Javascript很多语法借鉴自Java，但也受Awk, Perl和Python影响。</p>
<p>Javascript是大小写敏感的，使用Unicode字符集。</p>
<p>在Javascript中，语句被称为statements，并用分号分隔(;)。空格、制表符和换行符被称为空白。<br>Javascript的脚本的源文件从左到右扫描，并转换成由令牌，控制字符，行结束符，注释或空白组成的输入元素序列。<br>ECMAScript中还定义了某些关键字和字面量，并具有分号自动插入功能(ASI)来结束语句。但是，建议随时添加分号结束你的语句以避免副作用。</p>
<h2 id="注释-Comments"><a href="#注释-Comments" class="headerlink" title="注释(Comments)"></a>注释(Comments)</h2><p>注释语法和C++和其他语言相同：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//单行注释</span></div><div class="line"><span class="comment">/* 这是一个多行注释*/</span></div></pre></td></tr></table></figure></p>
<h2 id="声明-Declarations"><a href="#声明-Declarations" class="headerlink" title="声明(Declarations)"></a>声明(Declarations)</h2><p>Javascript有三种声明。</p>
<p>var 声明变量，可选择将其初始化为一个值<br>let 声明块范围局部变量(block scope local variable)，可选择将其初始化为一个值。<br>const 声明一个只读(read-only)命名常量。</p>
<h3 id="变量-variables"><a href="#变量-variables" class="headerlink" title="变量(variables)"></a>变量(variables)</h3><p>在应用程序中，使用变量来为值命名。变量的名称称为identifiers，需要遵守一定的规则。</p>
<p>在Javascript语言中，一个标识符(identifier)必须以字母、下划线(_)或者美元($)符号开头；后续的字符可以包含数字(0-9)。因为Javascript语言中是区分大小写的，这里所指的字母可以是(大写的)”A”到字母”Z”和小写的”a”到”z”。<br>从JavaScript 1.5版开始，你可以使用ISO 8859-1或Unicode编码的字符作标识符。你也可以使用\uXXXX字样的转义序列Unicode escape sequences作标识符。</p>
<h3 id="声明变量-Declaring-variables"><a href="#声明变量-Declaring-variables" class="headerlink" title="声明变量(Declaring variables)"></a>声明变量(Declaring variables)</h3><p>你可以用以下三种方式声明变量：</p>
<ul>
<li>使用关键词var.例如，var x = 42。这个语法可以同时用来声明局部和全局变量。</li>
<li>直接赋值。</li>
<li>使用关键词let。例如let y = 13。这个语法可以用来声明语句块代码段的局部变量(block scope local variable)。</li>
</ul>
<h3 id="对变量求值-Evaluation-variables"><a href="#对变量求值-Evaluation-variables" class="headerlink" title="对变量求值(Evaluation variables)"></a>对变量求值(Evaluation variables)</h3><p>用var或let声明的未赋初值的变量，值会被定义为undefined（即未定义值，本身也是一个值）。</p>
<p>试图访问一个未初始化的变量会导致一个ReferenceError异常被抛出：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a;</div><div class="line"><span class="built_in">console</span>.log(<span class="string">"The value of a is "</span>+a); <span class="comment">//logs的值未定义</span></div><div class="line"><span class="built_in">console</span>.log(<span class="string">"The value of b is "</span>+b); <span class="comment">//抛出ReferenceError异常</span></div></pre></td></tr></table></figure>
<p>你可以使用undefined来确定变量是否已赋值。以下的代码中，变量input未被赋值，因而if条件语句的求值结果是true。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> input;</div><div class="line"><span class="keyword">if</span>(input === <span class="literal">undefined</span>)&#123;</div><div class="line">    doThis();</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">    doThat();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>undefined值在布尔类型环境中会被当做false。例如，下面的代码将运行函数myFunction，因为数组myArray中的元素未被赋值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myArray = <span class="keyword">new</span> <span class="built_in">Array</span>();</div><div class="line"><span class="keyword">if</span>(!myArray[<span class="number">0</span>])&#123;</div><div class="line">    myFunction();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>数值类型环境中undefined值会被转换为NaN。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a;</div><div class="line">a + <span class="number">2</span>; <span class="comment">// Evaluates to NaN</span></div></pre></td></tr></table></figure>
<p>当你对一个空变量求值时，空值null在数值类型环境中会被当作0来对待，而布尔类型环境中会被当作false</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> n = <span class="literal">null</span>;</div><div class="line"><span class="built_in">console</span>.log(n * <span class="number">32</span>); <span class="comment">//logs 0</span></div></pre></td></tr></table></figure>
<h3 id="变量的域-Variable-scope"><a href="#变量的域-Variable-scope" class="headerlink" title="变量的域(Variable scope)"></a>变量的域(Variable scope)</h3><p>在所有函数之外声明的变量，叫做全局变量，因为它可被当前文档中的其他代码所访问。在函数内部声明的变量，叫做局部变量，因为它只能在该函数内部访问。</p>
<p>ECMAScript6之前的Javascript没有语句块作用域；相反，语句块中声明的变量将成为语句块所在代码段的局部变量。例如，如下的代码将在控制台输出5，因为x的作用域是声明了x的那个函数(或全局范围)，而不是if语句块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(<span class="literal">true</span>)&#123;</div><div class="line">    <span class="keyword">var</span> x = <span class="number">5</span>;</div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(x); <span class="comment">//5</span></div></pre></td></tr></table></figure>
<p>如果使用ECMAScript6中的let声明，上述行为将发生变化。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(<span class="literal">true</span>)&#123;</div><div class="line">    <span class="keyword">let</span> x = <span class="number">5</span>;</div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(x); <span class="comment">//ReferenceError: y is not defined.</span></div></pre></td></tr></table></figure>
<h3 id="变量声明提升-Variable-hoisting"><a href="#变量声明提升-Variable-hoisting" class="headerlink" title="变量声明提升(Variable hoisting)"></a>变量声明提升(Variable hoisting)</h3><p>JavaScript变量的另一个特别之处是，你可以引用稍后声明的变量，而不会引发异常。这一概念称为变量声明提升(hoisting)；JavaScript变量感觉上是被“举起”或提升到了所有函数和语句之前。然而提升后的变量将返回undefined值，所以即使在使用或引用某个变量之后存在声明和初始化操作，仍将得到undefined值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Example 1</div><div class="line"> */</div><div class="line"><span class="built_in">console</span>.log(x === <span class="literal">undefined</span>); <span class="comment">//logs "true"</span></div><div class="line"><span class="keyword">var</span> x = <span class="number">3</span>;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * Example 2</div><div class="line"> */</div><div class="line"><span class="comment">// will return a value of undefined</span></div><div class="line"><span class="keyword">var</span> myvar = <span class="string">"my value"</span>;</div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(myvar); <span class="comment">//undefined</span></div><div class="line">    <span class="keyword">var</span> myvar = <span class="string">"local value"</span>;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
<p>上面的例子，也可写作：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Example 1</div><div class="line"> */</div><div class="line"><span class="keyword">var</span> x;</div><div class="line"><span class="built_in">console</span>.log(x === <span class="literal">undefined</span>); <span class="comment">// logs "true"</span></div><div class="line">x = <span class="number">3</span>;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * Example 2</div><div class="line"> */</div><div class="line"><span class="keyword">var</span> myvar = <span class="string">"my value"</span>;</div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> myvar;</div><div class="line">  <span class="built_in">console</span>.log(myvar); <span class="comment">// undefined</span></div><div class="line">  myvar = <span class="string">"local value"</span>;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
<p>由于存在变量声明提升，一个函数中所有的var语句应尽可能地放在接近函数顶部的地方。这大大地提升了程序代码的清晰度。</p>
<h3 id="全局变量-Global-variables"><a href="#全局变量-Global-variables" class="headerlink" title="全局变量(Global variables)"></a>全局变量(Global variables)</h3><p>全局变量实际上是全局对象的属性。在网页中，全局对象是window，所以你可以用形如window.variable的语法来设置和访问全局变量。</p>
<p>因此，你可以通过制定window或frame的名字，从一个window或frame访问另一个window或frame中声明的变量。例如，设想一个叫phoneNumber的变量在文档里被声明，你可以在子框架里用phone.phoneNumber来引用它。</p>
<h2 id="常量-Constants"><a href="#常量-Constants" class="headerlink" title="常量(Constants)"></a>常量(Constants)</h2><p>你可以用关键字const创建一个只读(read-only)的常量。常量标识符的命名规则和变量的相同：必须以字母、下划线或美元符号开头并可以包含有字母、数字或下划线。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> prefix = <span class="string">'212'</span>;</div></pre></td></tr></table></figure>
<p>常量不可以通过赋值改变其值，也不可以在脚本运行时重新声明。<strong>它必须被初始化为某个值。</strong></p>
<p>常量的作用域规则与let会计作用域变量相同。若const关键字被省略了，该标识符将被视为变量。</p>
<p>在同一个作用域下，不能用于变量或函数同样的名字来命名常量。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//THIS WILL CAUSE AN ERROR</span></div><div class="line"> <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line"> <span class="keyword">const</span> f = <span class="number">5</span>;</div><div class="line"><span class="comment">// THIS WILL CAUSE AN ERROR ALSO</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">const</span> g = <span class="number">5</span>;</div><div class="line">    <span class="keyword">var</span> g;</div><div class="line">    <span class="comment">//statements</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="数据结构和类型"><a href="#数据结构和类型" class="headerlink" title="数据结构和类型"></a>数据结构和类型</h2><p>JavaScript语言可以识别下面7中不同类型的值：</p>
<ul>
<li>六种是原型的数据类型：<ol>
<li>Boolean. 布尔值，true和false.</li>
<li>null. 一个表明null值得特殊关键字。JavaScript是大小敏感的，因此null与Null、NULL或其他变量完全不同。</li>
<li>undefined. 变量未定义时的属性。</li>
<li>Number. 表示数字，例如：42或者3.14.</li>
<li>String. 表示字符串，例如：”Hello”。</li>
<li>Symbol(在ECMAScript6中新添加的类型)。一种数据类型，它的实例是唯一且不可改变的。</li>
</ol>
</li>
<li>以及Object对象</li>
</ul>
<p>仅凭这些为数不多的数据类型，在你的应用程序中他们就能够执行有用的功能。</p>
<p>Objects和functions是本语言的其他两个基本元素。你可以将对象视为存放值得命名容器，而将函数视为你的应用程序能够执行的过程(procedures)。</p>
<h3 id="数据类型的转换-Data-type-conversion"><a href="#数据类型的转换-Data-type-conversion" class="headerlink" title="数据类型的转换(Data type conversion)"></a>数据类型的转换(Data type conversion)</h3><p>JavaScript是一种动态类型语言(dynamically typed language)。这意味着你声明变量时可以不指定数据类型，而数据会在脚本执行需要时自动转换。那么，你可以这样来定义变量：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> answer = <span class="number">42</span>;</div></pre></td></tr></table></figure>
<p>然后，你还可以给同一个变量分配一个字符串值，例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">answer = <span class="string">"hello world!"</span>;</div></pre></td></tr></table></figure>
<p>因为JavaScript是动态类型的，这样的指定并不会提示出错。</p>
<p>再涉及加法运算符(+)的数字和字符串表达式中，JavaScript会把数字值转换为字符串。例如，假设有如下的语句：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">x = <span class="string">"The answer is "</span> + <span class="number">42</span> <span class="comment">// "The answer is 42"</span></div><div class="line">y = <span class="number">42</span> + <span class="string">" is the answer"</span> <span class="comment">// "42 is the answer"</span></div></pre></td></tr></table></figure>
<p>在涉及其他运算符(如下面的减号)时，JavaScript语言不会把数字变为字符。例如(第一例是数字运算符，第二例是字符串运算符):</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">"37"</span> - <span class="number">7</span> <span class="comment">// 30</span></div><div class="line"><span class="string">"37"</span> + <span class="number">7</span> <span class="comment">// "377"</span></div></pre></td></tr></table></figure>
<h3 id="字符串转化为数字-converting-strings-to-numbers"><a href="#字符串转化为数字-converting-strings-to-numbers" class="headerlink" title="字符串转化为数字(converting strings to numbers)"></a>字符串转化为数字(converting strings to numbers)</h3><p>有一些方法可以将内存中表示一个数字的字符串转换为对应的数字<br>parseInt()和parseFloat()</p>
<p>parseInt仅能够返回整数，所以使用它会丢失小数部分。另外，调用parseInt时最好总是带上进制(radix)参数，这个参数用于指定使用哪一种数制。</p>
<h4 id="单目加法运算符"><a href="#单目加法运算符" class="headerlink" title="单目加法运算符"></a>单目加法运算符</h4><p><strong>将字符串转换为数字的另一种方法是使用单目加法运算符。</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">"1.1"</span> + <span class="string">"1.1"</span> = <span class="string">"1.11.1"</span></div><div class="line">(+<span class="string">"1.1"</span>) + (+<span class="string">"1.1"</span>) = <span class="number">2.2</span>   <span class="comment">// 注：加入括号为清楚起见，不是必需的。</span></div></pre></td></tr></table></figure>
<h2 id="字面值-Literals"><a href="#字面值-Literals" class="headerlink" title="字面值(Literals)"></a>字面值(Literals)</h2><p>(注：字面值是由语法表达式定义的常量；或通过一定字辞组成的语词表达式定义的常量)</p>
<p>在JavaScript中，你可以使用各种字面值。这些字面值是脚本中按字面意思给出的固定的值，而不是变量。(字面值是常量，其值是固定的，而且在程序脚本运行中不可更改，比如false,3.1415,thisStringOfHelloWorld,invokedFunction: myFunction(“myArgument”))</p>
<h3 id="数组字面值-Array-Literals"><a href="#数组字面值-Array-Literals" class="headerlink" title="数组字面值(Array Literals)"></a>数组字面值(Array Literals)</h3><p>数组字面值是一个封闭在方括号对([])中的包含有零个或多个表达式的列表，其中每个表达式代表数组的一个元素。当你使用数组字面值创建一个数组时，该数组将会以指定的值作为它的元素进行初始化，而其长度被设定为元素的个数。</p>
<p>下面的示例用3个元素生成数组coffees，它的长度是3。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> coffees = [<span class="string">"French Roast"</span>, <span class="string">"Colombian"</span>, <span class="string">"Kona"</span>];</div><div class="line"><span class="keyword">var</span> a=[<span class="number">3</span>];</div><div class="line"><span class="built_in">console</span>.log(a.length); <span class="comment">// 1</span></div><div class="line"><span class="built_in">console</span>.log(a[<span class="number">0</span>]); <span class="comment">// 3</span></div></pre></td></tr></table></figure>
<p>若在顶层（全局）脚本里用字面值创建数组，JavaScript语言会在每次对包含该数组字面值的表达式时解释该数组。另一方面，在函数中使用的数组，将在每次调用函数时被创建一次。</p>
<p>数组字面值同时也是数组对象。</p>
<p><strong>数组字面值中的多余逗号</strong><br>你不必列举数组字面值中的所有元素。若你在同一行中连写两个逗号（,），数组中就会产生一个没被指定的元素，其初始值是undefined。以下示例创建了一个名为fish的数组：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fish = [<span class="string">"Lion"</span>, , <span class="string">"Angel"</span>];</div></pre></td></tr></table></figure>
<p>这个数组中，有两个已被赋值的元素，和一个空元素，此时的数组的长度是3.</p>
<p>若你在元素列表的尾部添加了一个逗号，它会被忽略。在下面的例子中，该数组的长度是3.并不存在myList[3]这个元素。元素列表中所有其他的逗号都表示一个新元素（的开始）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myList = [<span class="string">'home'</span>, , <span class="string">'school'</span>, ];</div></pre></td></tr></table></figure>
<p>在下面的例子中，数组的长度是4，元素myList[0]和myList[2]缺失（译注：没被赋值，因而是undefined）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myList = [ , <span class="string">'home'</span>, , <span class="string">'school'</span>];</div></pre></td></tr></table></figure>
<p>又一个例子，在这里该数组的长度是4，元素myList[1]和myList[3]被漏掉了。（但是）只有最后的那个逗号被忽略。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myList = [<span class="string">'home'</span>, , <span class="string">'school'</span>, , ];</div></pre></td></tr></table></figure>
<p>理解多余的逗号（在脚本运行时会被如何处理）的含义，对于从语言层面理解JavaScript是十分重要的。但是，你自己写代码时：<strong>显式地将缺失的元素声明为undefined，将大大增加你的代码的清晰度和可维护性</strong>。</p>
<h3 id="布尔字面值-Boolean-literals"><a href="#布尔字面值-Boolean-literals" class="headerlink" title="布尔字面值(Boolean literals)"></a>布尔字面值(Boolean literals)</h3><p>布尔类型有两种字面值：true和false。</p>
<p>不要混淆作为布尔对象的真和假与布尔类型的原始值true和false。布尔对象是原始布尔数据类型的一个包装器。</p>
<h3 id="整数-Intergers"><a href="#整数-Intergers" class="headerlink" title="整数(Intergers)"></a>整数(Intergers)</h3><p>整数可以被表示成十进制(基数为10)、十六进制(基数为16)以及八进制(基数为8)。</p>
<ul>
<li>十进制整数字组成的数字序列，不带前导0.</li>
<li>带前导0、0O、0o的整数字面值表明它是八进制。八进制整数只能包括数字0-7。</li>
<li>前缀0x或0X表示十六进制。十六进制整数，可以包含数字（0-9）和字母a~f或A~F。</li>
</ul>
<h3 id="浮点数字面值-Floating-point-literal"><a href="#浮点数字面值-Floating-point-literal" class="headerlink" title="浮点数字面值(Floating-point literal)"></a>浮点数字面值(Floating-point literal)</h3><p>浮点数字面值可以有以下的组成部分：</p>
<ul>
<li>一个十进制整数，它可以带符号（即前面的”+”或”-“号），</li>
<li>一个小数点（”.”），</li>
<li>一个小数部分（由一串十进制数表示），</li>
<li>一个指数部分</li>
</ul>
<p>指数部分是以”e”或”E”开头后面跟着一个整数，可以有正负号（即前面写”+”或”-“）。一个浮点数字面值必须至少有一位数字，后接小数点或者”e”(“E”)组成。</p>
<p>一些浮点数字面值的例子，如3.1415,-3.1415,1e12以及2E-12。</p>
<p>简而言之，其语法是：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[(+|-)][digits][.digits][(E|e)[(+|-)]digits]</div></pre></td></tr></table></figure></p>
<h3 id="对象字面量-Object-literals"><a href="#对象字面量-Object-literals" class="headerlink" title="对象字面量(Object literals)"></a>对象字面量(Object literals)</h3><p>对象字面值是封闭在花括号对({})中的一个对象的零个或多个”属性名-值”对的（元素）列表。你不能在一条语句的开头就使用对象字面值，这将导致错误或非你所预想的行为，因为此时左花括号({)会被认为一个语句块的齐师傅好。</p>
<p>以下是一个对象字面值的例子。对象car的第一个元素（译注：即一个属性双值对）定义了属性myCar；第二个元素，属性getCar，引用了一个函数（即CarTypes(“Honda”)）；第三个元素，属性special，使用了一个已有的变量（即Sales）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Sales = <span class="string">"Toyota"</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">CarTypes</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> (name === <span class="string">"Honda"</span>) ?</div><div class="line">    name :</div><div class="line">    <span class="string">"Sorry, we don't sell "</span> + name + <span class="string">"."</span> ;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> car = &#123; <span class="attr">myCar</span>: <span class="string">"Saturn"</span>, <span class="attr">getCar</span>: CarTypes(<span class="string">"Honda"</span>), <span class="attr">special</span>: Sales &#125;;</div><div class="line"><span class="built_in">console</span>.log(car.myCar);   <span class="comment">// Saturn</span></div><div class="line"><span class="built_in">console</span>.log(car.getCar);  <span class="comment">// Honda</span></div><div class="line"><span class="built_in">console</span>.log(car.special); <span class="comment">// Toyota</span></div></pre></td></tr></table></figure>
<p>更进一步的，你可以使用数字或字符串字面值作为属性的名字，或者在另一个字面值内嵌套上一个字面值。如下的示例中使用了这些可选项</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> car = &#123; <span class="attr">manyCars</span>: &#123;<span class="attr">a</span>: <span class="string">"Saab"</span>, <span class="string">"b"</span>: <span class="string">"Jeep"</span>&#125;, <span class="number">7</span>: <span class="string">"Mazda"</span> &#125;;</div><div class="line"><span class="built_in">console</span>.log(car.manyCars.b); <span class="comment">// Jeep</span></div><div class="line"><span class="built_in">console</span>.log(car[<span class="number">7</span>]); <span class="comment">// Mazda</span></div></pre></td></tr></table></figure>
<p>对象属性名字可以是任意字符串，包括空串。如果对象属性名字不是合法的javascript标识符，它必须用””包裹。属性的名字不合法，那么便不能用.访问属性值，而是通过类数组标记(“[]”)访问和赋值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> unusualPropertyNames = &#123;</div><div class="line">  <span class="string">""</span>: <span class="string">"An empty string"</span>,</div><div class="line">  <span class="string">"!"</span>: <span class="string">"Bang!"</span></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(unusualPropertyNames.<span class="string">""</span>);   <span class="comment">// 语法错误: Unexpected string</span></div><div class="line"><span class="built_in">console</span>.log(unusualPropertyNames[<span class="string">""</span>]);  <span class="comment">// An empty string</span></div><div class="line"><span class="built_in">console</span>.log(unusualPropertyNames.!);    <span class="comment">// 语法错误: Unexpected token !</span></div><div class="line"><span class="built_in">console</span>.log(unusualPropertyNames[<span class="string">"!"</span>]); <span class="comment">// Bang!</span></div></pre></td></tr></table></figure>
<p>在ES2015，对象文本扩展到支持在原型设置建造，简写foo:foo分配，界定方法，得到很好的名称，并与表达式计算属性名。总之，这些也带来了对象文字和类声明紧密联系起来，让基于对象的设计得益于一些同样的便利。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;</div><div class="line">    <span class="comment">//__proto__</span></div><div class="line">    __proto__: theProtoObj,</div><div class="line">    <span class="comment">// Shorthand for 'handler:handler'</span></div><div class="line">    handler,</div><div class="line">    <span class="comment">//Methods</span></div><div class="line">    toString()&#123;</div><div class="line">        <span class="comment">//super calls</span></div><div class="line">        <span class="keyword">return</span> <span class="string">"d"</span> + <span class="keyword">super</span>.toString();</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">//Computed (dynamic) property names</span></div><div class="line">    [ <span class="string">'prop_'</span> + <span class="function">(<span class="params">(</span>) =&gt;</span> <span class="number">42</span>)() ]:<span class="number">42</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="RegExp-literals"><a href="#RegExp-literals" class="headerlink" title="RegExp literals"></a>RegExp literals</h3><p>一个正则表达式是字符被斜线围成的表达式。下面是一个正则表达式文字的一个例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> re = <span class="regexp">/ab+c/</span>;</div></pre></td></tr></table></figure>
<h3 id="字符串字面值"><a href="#字符串字面值" class="headerlink" title="字符串字面值"></a>字符串字面值</h3><p>字符串字面值可以包含零个或多个字符，由双引号对或单引号对包围。字符串被限定在同种引号之间。<br>你可以在字符串字面值上使用字符串对象的所有方法–JavaScript会自动将字符串字面值转换为一个临时字符串对象，调用该方法，然后废弃掉那个临时的字符串变量。你也能对字符串字面值使用类似String.length的属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">"John's cat"</span>.length</div></pre></td></tr></table></figure>
<p>除非有特别需要使用字符串对象，否则，你应当始终使用字符串字面值。</p>
<p>在字符串中使用的特殊字符<br>作为一般字符的扩展，你可以在字符串中使用特殊字符</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">"one line \n another line"</span></div></pre></td></tr></table></figure>
<p>以下表格列举了你能在JavaScript的字符串中使用的特殊字符。</p>
<table>
<thead>
<tr>
<th>Character</th>
<th style="text-align:center">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>\0</td>
<td style="text-align:center">空字符</td>
</tr>
<tr>
<td>\b</td>
<td style="text-align:center">退格</td>
</tr>
<tr>
<td>\f</td>
<td style="text-align:center">换页符</td>
</tr>
<tr>
<td>\n</td>
<td style="text-align:center">换行符</td>
</tr>
<tr>
<td>\r</td>
<td style="text-align:center">回车符</td>
</tr>
<tr>
<td>\t</td>
<td style="text-align:center">Tab制表符</td>
</tr>
<tr>
<td>\v</td>
<td style="text-align:center">垂直制表符</td>
</tr>
<tr>
<td>\’</td>
<td style="text-align:center">单引号</td>
</tr>
<tr>
<td>\”</td>
<td style="text-align:center">双引号</td>
</tr>
<tr>
<td>\</td>
<td style="text-align:center">反斜杠字符()</td>
</tr>
<tr>
<td>\XXX</td>
<td style="text-align:center">通过最多三个八进制位数x377.例如在0和指定的Latin-1编码的字符，\251是版本符号八进制序列。</td>
</tr>
<tr>
<td>\xXX</td>
<td style="text-align:center">由00和FF之间的两个十六进制数字XX指定的Latin-1编码的字符。例如，版权所有\ xA9为版权符号十六进制序列。</td>
</tr>
<tr>
<td>\uXXXX</td>
<td style="text-align:center">由四个十六进制数字XXXX规定的Unicode字符。例如，\ u00A9为版权符号的Unicode序列。见Unicode转义序列。</td>
</tr>
<tr>
<td>\u{XXXXX}</td>
<td style="text-align:center">Unicode code point escapes. For example, \u{2F804} is the same as the simple Unicode escapes \uD87E\uDC04.</td>
</tr>
</tbody>
</table>
<p>转义字符<br>对于那些未出现在表2.1中的字符，其所带的前导反斜线’\’将被忽略。但是，这一用法已被废弃，应当避免使用。</p>
<p>通过在引号前加上反斜线’\’，可以在字符串中插入引号，这就是引号转义。例如:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> quote = <span class="string">"He read \"The Cremation of Sam McGee\" by R.W. Service."</span>;</div><div class="line"><span class="built_in">console</span>.log(quote); <span class="comment">// He read "The Cremation of Sam McGee" by R.W. Service.</span></div></pre></td></tr></table></figure></p>
<p>要在字符串中插入’\’字面值，必须转义反斜线。例如，要把文件路径 c:\temp 赋值给一个字符串，可以采用如下方式:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> home = <span class="string">"c:\\temp"</span>;</div></pre></td></tr></table></figure></p>
<p>也可以在换行之前加上反斜线以转义换行（译注：实际上就是一条语句拆成多行书写），这样反斜线和换行都不会出现在字符串的值中。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> str = <span class="string">"this string \</span></div><div class="line">is broken \</div><div class="line">across multiple\</div><div class="line">lines."</div><div class="line"><span class="built_in">console</span>.log(str);   <span class="comment">// this string is broken across multiplelines.</span></div></pre></td></tr></table></figure></p>
<p>Javascript没有“heredoc”语法，但可以用行末的换行符转义和转义的换行来近似实现<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> poem = </div><div class="line"><span class="string">"Roses are red,\n\</span></div><div class="line">Violets are blue.\n\</div><div class="line">I'm schizophrenic,\n\</div><div class="line">And so am I."</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/09/Immutable详解及React中实践/" itemprop="url">
                  Immutable详解及React中实践
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-09T23:52:22+08:00" content="2016-05-09">
              2016-05-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/教程/" itemprop="url" rel="index">
                    <span itemprop="name">教程</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/09/Immutable详解及React中实践/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/09/Immutable详解及React中实践/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Shared mutable state is the root of all evil</p>
</blockquote>
<p>有人说Immutable可以给React应用带来数十倍的提升，也有人说Immutable的引入是近期Javascript中伟大的发明，因为同期React太火，它的光芒被掩盖了。这些至少说明Immutable是很有价值的。</p>
<p>Javascript中的对象一般是可变的(mutable)，因为使用了引用赋值，新的对象简单的引用了原始对象，改变新的对象将影响到原始对象。虽然这样做可以节约内存，但是当应用复杂后，这就造成了非大的隐患，Mutable带来的优点变得得不偿失。为了解决这个问题，一般的做法是使用shallowCopy(浅拷贝)或deepCopy(深拷贝)来避免被修改，但这样做造成了CPU和内存的浪费。</p>
<p>而Immutable可以很好的解决这些问题。</p>
<p>##什么是Immutable Data<br>Immutable Data就是一旦创建，就不能再被更改的数据。对Immutable对象的任何修改或添加删除操作都会返回一个新的Immutable对象。Immutable实现的原理是Persistent Data Structure(持久化数据结构)，也就是使用旧的数据创建新的数据时，要保证旧数据同时可用且不变。同时为了避免deepCopy把所有的节点的都复制一遍带来的性能损耗，Immutable使用了Structure Sharing(结构共享)，即如果对象树中一个节点发生变化，只修改这个节点和受它影响的父节点，其他节点则进行共享。</p>
<p>目前流行的Immutable库有两个：</p>
<h3 id="immutable-js"><a href="#immutable-js" class="headerlink" title="immutable.js"></a>immutable.js</h3><p>Facebook工程师Lee Byron花费3年时间打造，与React同期出现，但没有被默认放到React工具库里(React提供了简化的Helper)。它内部实现了一套完整的Persistent Data Structure，还有很多易用的数据类型。像Collection、List、Map、Set、Record、Seq.有非常全面的map、filter、groupBy、reduce <code>find</code>函数式操作方法。同事API也尽量与Object或Array类似。<br>其中有3种最重要的数据结构：</p>
<ul>
<li>Map:键值对集合，对应于Object,ES6也有专门的Map对象</li>
<li>List: 有序可重复的列表，对应于Array</li>
<li>Set: 无序且不可重复的列表</li>
</ul>
<h3 id="seamless-immutable"><a href="#seamless-immutable" class="headerlink" title="seamless-immutable"></a>seamless-immutable</h3><p>与 Immutable.js 学院派的风格不同，seamless-immutable 并没有实现完整的 Persistent Data Structure，而是使用 Object.defineProperty（因此只能在 IE9 及以上使用）扩展了 JavaScript 的 Array 和 Object 对象来实现，只支持 Array 和 Object 两种数据类型，API 基于与 Array 和 Object 操持不变。代码库非常小，压缩后下载只有 2K。而 Immutable.js 压缩后下载有 16K。</p>
<p>下面是例子<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//原来的写法</span></div><div class="line"><span class="keyword">let</span> foo = &#123;<span class="attr">a</span>:&#123;<span class="attr">b</span>:<span class="number">1</span>&#125;&#125;;</div><div class="line"><span class="keyword">let</span> bar = foo;</div><div class="line">bar.a.b = <span class="number">2</span>;</div><div class="line"><span class="built_in">console</span>.log(foo.a.b); <span class="comment">//2</span></div><div class="line"><span class="built_in">console</span>.log(foo === bar); <span class="comment">//true</span></div><div class="line"><span class="comment">//使用immutable.js后</span></div><div class="line"><span class="keyword">import</span> Immutable <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line">foo = Immutable.fromJS(&#123;<span class="attr">a</span>:&#123;<span class="attr">b</span>:<span class="number">1</span>&#125;&#125;);</div><div class="line">bar = foo.setIn([<span class="string">'a'</span>,<span class="string">'b'</span>],<span class="number">2</span>); <span class="comment">// 使用setIn赋值</span></div><div class="line"><span class="built_in">console</span>.log(foo.getIn([<span class="string">'a'</span>,<span class="string">'b'</span>])); <span class="comment">//1</span></div><div class="line"><span class="built_in">console</span>.log(foo === bar); <span class="comment">// false</span></div><div class="line"><span class="comment">//使用seamless-immutable.js后</span></div><div class="line"><span class="keyword">import</span> SImmutable <span class="keyword">from</span> <span class="string">'seamless-immutable'</span>;</div><div class="line">foo = SImmutable(&#123;<span class="attr">a</span>:&#123;<span class="attr">b</span>:<span class="number">1</span>&#125;&#125;);</div><div class="line">bar = foo.merge(&#123;<span class="attr">a</span>:&#123;<span class="attr">b</span>:<span class="number">2</span>&#125;&#125;); <span class="comment">//使用merge赋值</span></div><div class="line"><span class="built_in">console</span>.log(foo.a.b); <span class="comment">//1</span></div><div class="line"><span class="built_in">console</span>.log(foo === bar); <span class="comment">//false</span></div></pre></td></tr></table></figure></p>
<h2 id="Immutable优点"><a href="#Immutable优点" class="headerlink" title="Immutable优点"></a>Immutable优点</h2><ol>
<li>Immutable降低了Mutable带来的复杂度<br>可变(Mutable)数据耦合了Time和Value的概念，造成了数据很难被回溯。<br>比如下面的一段代码：</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">touchAndLog</span>(<span class="params">touchFn</span>)</span>&#123;</div><div class="line">    <span class="keyword">let</span> data = &#123;<span class="attr">key</span>:<span class="string">'value'</span>&#125;;</div><div class="line">    touchFn(data);</div><div class="line">    <span class="built_in">console</span>.log(data.key);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在不查看touchFn的代码的情况下，因为不确定它对data做了什么，你是不可能知道会打印什么的。但是如果data是Immutable，你可以知道打印的是value。</p>
<ol>
<li>节省内存<br>Immutable.js使用了Structure Sharing 会尽量复用内存，甚至以前使用的对象也可以再次被复用。没有被引用的对象会被垃圾回收。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;<span class="built_in">Map</span>&#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"><span class="keyword">let</span> a = <span class="built_in">Map</span>(&#123;</div><div class="line">    <span class="attr">select</span>: <span class="string">'users'</span>,</div><div class="line">    <span class="attr">filter</span>: <span class="built_in">Map</span>(&#123;<span class="attr">name</span>:<span class="string">'Tom'</span>&#125;)</div><div class="line">&#125;)</div><div class="line"><span class="keyword">let</span> b = a.set(<span class="string">'select'</span>,<span class="string">'people'</span>);</div><div class="line">a===b; <span class="comment">//false</span></div><div class="line">a.get(<span class="string">'filter'</span>) === b.get(<span class="string">'filter'</span>) <span class="comment">//true</span></div></pre></td></tr></table></figure>
<p>上面的a和b共享了没有变化的filter节点。</p>
<ol>
<li><p>Undo/Redo, Copy/Paste, 甚至时间旅行这些功能做起来小菜一碟<br>因为每次数据都是不一样的，只要把这些数据放到一个数组里存储起来，想回退到哪里就拿出对应的数据即可，很容易开发出撤销重做这种功能。</p>
</li>
<li><p>并发安全<br>传统的并发非常难做，因为要处理各种数据不一致问题，因此有人就发明了各种锁来解决。但是使用了Immutable之后，数据天生是不可变的，并发锁就不需要了。</p>
</li>
</ol>
<p>然而现在并没有什么卵用，因为Javascript是单线程运行的，但未来可能会加入。</p>
<ol>
<li>拥抱函数式编程<br>Immutable本身就是函数式编程中的概念，纯函数式编程比面向对象更适用于前端开发。因为只要输入一致，输出必然一致，这样开发的组件更易于调试和组装。</li>
</ol>
<p>像ClojureScript,Elm等函数式编程语言中的数据类型天生都是Immutable的，这也是为什么ClojureScript基于React的框架，OM性能比React还要好的原因。</p>
<h2 id="Immutable的缺点"><a href="#Immutable的缺点" class="headerlink" title="Immutable的缺点"></a>Immutable的缺点</h2><p>容易与原生的对象混淆<br>这点使我们使用Immutable.js过程中遇到的最大的问题。写代码要做思维上的转变。</p>
<p>虽然Immutable.js尽量尝试把API设计的原生对象类似，有的时候还是很难区别到底是Immutable对象还是原生对象，容易混淆操作。</p>
<p>Immutable中的Map和List虽然对应原生Object和Array，但操作非常不同，比如你要用map.get(‘key’)而不是map.key，array.get(0)而不是array[0]。另外Immutable每次修改都会返回新对象，很容易忘记赋值。</p>
<p>当使用外部库的时候，一般需要使用原生对象，也很容易忘记转换。</p>
<p>下面给出了一些办法来避免类似问题发生：</p>
<ol>
<li>使用Flow或TypeScript这类有静态类型检查的工具。</li>
<li>约定变量命名规则：如所有Immutable类型对象以$$开头。</li>
<li>使用Immutable.fromJS而不是Immutable.Map或Immutable.List来创建对象，这样可以避免Immutable和原生对象间的混用。</li>
</ol>
<h2 id="更多认识"><a href="#更多认识" class="headerlink" title="更多认识"></a>更多认识</h2><p>两个immutable对象可以使用 === 来比较，这样是直接比较内存地址，性能最好。但即使两个对象的值是一样的，也会返回false</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> map1 = Immutable.Map(&#123;<span class="attr">a</span>:<span class="number">1</span>,<span class="attr">b</span>:<span class="number">1</span>,<span class="attr">c</span>:<span class="number">1</span>&#125;);</div><div class="line"><span class="keyword">let</span> map2 = Immutable.Map(&#123;<span class="attr">a</span>:<span class="number">1</span>,<span class="attr">b</span>:<span class="number">1</span>,<span class="attr">c</span>:<span class="number">1</span>&#125;);</div><div class="line">map1 === map2; <span class="comment">//false</span></div></pre></td></tr></table></figure>
<p>为了直接比较对象的值，immutable.js提供了Immutable.js来做值比较：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Immutable.is(map1,map2); <span class="comment">//true</span></div></pre></td></tr></table></figure>
<p>Immutable.is比较的是两个对象的hashCode或valueOf(对于javascript对象)。由于immutable内部使用了Tree数据结构来存储，只要两个对象的hashCode相等，值就是一样的。这样的算法避免了深度遍历比较，性能非常好。</p>
<p>后面会使用Immutable.js来减少React重复渲染，提高性能。</p>
<p>与Object.freeze、const比较<br>ES6中新加入的Object.freeze和const都可以达到防止对象被篡改的功能，但是它们是shallowCopy的。对象层级一深就要特殊处理了。</p>
<p>Cursor的概念<br>这个Cursor和数据库中的游标是完全不同的而概念。</p>
<p>由于Immutable数据一般嵌套非常深，为了便于访问深层数据，Cursor提供了直接访问这个深层数据的引用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Immutable <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"><span class="keyword">import</span> Cursor <span class="keyword">from</span> <span class="string">'immutable/contrib/cursor'</span>;</div><div class="line"><span class="keyword">let</span> data = Immutable.fromJS(&#123;<span class="attr">a</span>:&#123;<span class="attr">b</span>:&#123;<span class="attr">c</span>:<span class="number">1</span>&#125;&#125;&#125;);</div><div class="line"><span class="comment">//让cursor指向&#123;c:1&#125;</span></div><div class="line"><span class="keyword">let</span> cursor = Cursor.from(data,[<span class="string">'a'</span>,<span class="string">'b'</span>],newData =&gt; &#123;</div><div class="line">    <span class="comment">//当cursor或其子cursor执行update时调用</span></div><div class="line">    <span class="built_in">console</span>.log(newData);</div><div class="line">&#125;);</div><div class="line">cursor.get(<span class="string">'c'</span>); <span class="comment">//1</span></div><div class="line">cursor = cursor.update(<span class="string">'c'</span>,x =&gt; x+<span class="number">1</span>);</div><div class="line">cursor.get(<span class="string">'c'</span>); <span class="comment">//2</span></div></pre></td></tr></table></figure>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><h3 id="与React搭配使用，Pure-Render"><a href="#与React搭配使用，Pure-Render" class="headerlink" title="与React搭配使用，Pure Render"></a>与React搭配使用，Pure Render</h3><p>熟悉React的都知道，React做性能优化时有一个避免重复渲染的大招，就是使用shouldComponentUpdate(),但它默认返回true，即始终会执行render()方法，然后做Virtual DOM比较，并得到是否需要做真实DOM更新，这里往往会带来很多无必要的渲染并成为性能瓶颈。</p>
<p>当然我们也可以在shouldComponentUpdate()中使用deepCopy和deepCompare来避免无必要的render(),但deepCopy和deepCompare一般都是非常耗性能。</p>
<p>Immutable则提供了简洁高效的而判断数据是否变化的方法，只需 === 和is比较就能知道是否需要执行render(),而这个操作几乎0成本，所以可以极大提高性能。修改后的shouldComponentUpdate是这样的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;is&#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line">shouldComponentUpdate: <span class="function">(<span class="params">nextProps,nextState</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span> !(<span class="keyword">this</span>.props === nextProps || is(<span class="keyword">this</span>.props,nextProps)) || !(<span class="keyword">this</span>.state === nextState || is(<span class="keyword">this</span>.state,nextState));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当然你也可以借助React.addons.PureRenderMixin 或支持class语法的pure-render-decorator来实现。</p>
<p>setState的一个技巧</p>
<p>React建议把this.state当作Immutable的，因此修改前需要做一个deepCopy,显得麻烦：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="string">'_'</span> <span class="keyword">from</span> <span class="string">'lodash'</span>;</div><div class="line"><span class="keyword">const</span> Component = React.createClass(&#123;</div><div class="line">    getInitialState()&#123;</div><div class="line">        <span class="keyword">return</span>&#123;</div><div class="line">            <span class="attr">data</span>:&#123;<span class="attr">times</span>:<span class="number">0</span>&#125;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    handleAdd()&#123;</div><div class="line">        <span class="keyword">let</span> data = _.cloneDeep(<span class="keyword">this</span>.state.data);</div><div class="line">        data.times = data.times + <span class="number">1</span>;</div><div class="line">        <span class="keyword">this</span>.setState(&#123;<span class="attr">data</span>:data&#125;);</div><div class="line">        <span class="comment">//如果上面不做cloneDeep，下面打印的结果会是已经加1后的值。</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.data.times);</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>使用Immutable后：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">getInitialState()&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">data</span>: <span class="built_in">Map</span>(&#123;<span class="attr">times</span>:<span class="number">0</span>&#125;)</div><div class="line">    &#125;</div><div class="line">&#125;,</div><div class="line">handleAdd()&#123;</div><div class="line">    <span class="keyword">this</span>.setState(&#123;<span class="attr">data</span>:<span class="keyword">this</span>.state.data.update(<span class="string">'times'</span>,v =&gt; v+<span class="number">1</span>)&#125;);</div><div class="line">    <span class="comment">//这时的times并不会改变</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.data.get(<span class="string">'times'</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的handleAdd可以简写成：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">handleAdd()&#123;</div><div class="line">    <span class="keyword">this</span>.setState(<span class="function">(<span class="params">&#123;data&#125;</span>) =&gt;</span> (&#123;</div><div class="line">        <span class="attr">data</span>: data.update(<span class="string">'times'</span>, v =&gt; v+<span class="number">1</span>)&#125;)</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="与Flux搭配使用"><a href="#与Flux搭配使用" class="headerlink" title="与Flux搭配使用"></a>与Flux搭配使用</h2><p>由于Flux并没有限定Store中的数据类型，使用Immutable非常简单。<br>下面是实现一个类似带有添加和撤销功能Store:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;<span class="built_in">Map</span>, OrderedMap&#125; <span class="keyword">from</span> <span class="string">'immutable'</span>;</div><div class="line"><span class="keyword">let</span> todos = OrderedMap();</div><div class="line"><span class="keyword">let</span> history = []; <span class="comment">//普通数组，存放每次操作后产生的数据</span></div><div class="line"><span class="keyword">let</span> TodoStore = createStore(&#123;</div><div class="line">    getAll()&#123;</div><div class="line">        <span class="keyword">return</span> todos;</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line">Dispatcher.register(<span class="function"><span class="params">action</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">if</span>(action.actionType === <span class="string">'create'</span>)&#123;</div><div class="line">        <span class="keyword">let</span> id = createGUID();</div><div class="line">        history.push(todos); <span class="comment">//记录当前操作前的数据，便于撤销</span></div><div class="line">        todos = todos.set(id,<span class="built_in">Map</span>(&#123;</div><div class="line">            <span class="attr">id</span>: id,</div><div class="line">            <span class="attr">complete</span>: <span class="literal">false</span>,</div><div class="line">            <span class="attr">text</span>: action.text.trim()</div><div class="line">        &#125;));</div><div class="line">        TodoStore.emitChange();</div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(action.actionType === <span class="string">'undo'</span>)&#123;</div><div class="line">        <span class="keyword">if</span>(history.length &gt; <span class="number">0</span>)&#123;</div><div class="line">            todos = history.pop();</div><div class="line">        &#125;</div><div class="line">        TodoStore.emitChange();</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="与Redux搭配使用"><a href="#与Redux搭配使用" class="headerlink" title="与Redux搭配使用"></a>与Redux搭配使用</h2><p>Redux是目前最流行的Flux衍生库。它简化了Flux中多个Store的概念，只有一个Store，数据操作通过Reducer中实现；同时它提供了更简洁和清晰的单项数据流(View -&gt; Action -&gt; Middleware -&gt; Reducer),也更易于开发同构应用。</p>
<p>由于 Redux 中内置的 combineReducers 和 reducer 中的 initialState 都为原生的 Object 对象，所以不能和 Immutable 原生搭配使用。</p>
<p>幸运的是，Redux 并不排斥使用 Immutable，可以自己重写 combineReducers 或使用 redux-immutablejs 来提供支持。</p>
<p>上面我们提到 Cursor 可以方便检索和 update 层级比较深的数据，但因为 Redux 中已经有了 select 来做检索，Action 来更新数据，因此 Cursor 在这里就没有用武之地了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Immutable可以给应用带来极大的性能提升，但是否使用还要看项目情况。由于侵入性较强，新项目引入比较容易，老项目迁移需要评估迁移。对于一些提供给外部使用的公共组件，最好不要把Immutable对象直接暴露在对外接口中。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/09/reduce的用法/" itemprop="url">
                  reduce的用法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-09T23:05:47+08:00" content="2016-05-09">
              2016-05-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/教程/" itemprop="url" rel="index">
                    <span itemprop="name">教程</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/09/reduce的用法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/09/reduce的用法/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Real dream is the other shore of reality.</p>
</blockquote>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>reduce() 方法接收一个函数作为累加器(accumulator)，数组中的每个值（从左到右）开始合并，最终为一个值。</p>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr.reduce(callback,[initialValue])</div></pre></td></tr></table></figure>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><p>执行数组中的每个值得函数，包含四个参数</p>
<p>previousValue – 上一次回调函数返回的值，或者是提供的初始值(initialValue)</p>
<p>currentValue – 数组中当前被处理的元素</p>
<p>index – 当前元素在数组中的索引</p>
<p>array – 调用reduce的数组</p>
<p>initialValue – 作为第一次调用callback的第一个参数。</p>
<h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>reduce为数组中的每一个元素依次执行回调函数，不包括数组中被删除或从未被赋值的元素，接受四个参数：初始值（或者上一次回调函数的返回值），当前元素，当前索引，调用reduce的数组。</p>
<p>回调函数第一次执行时，preciousValue和currentValue可以是一个值，如果initialValue在调用reduce时被提供，那么第一个preciousValue等于initialValue，并且currentValue等于数组中的第一个值；如果initialValue未被提供，那么previousValue等于数组中的第一个值，currentValue等于数组中的第二个值。</p>
<p>如果数组为空并且没有提供initialValue，会抛出TypeError。如果数组仅有一个元素（无论位置如何）并且没有提供initialValue，或者有提供initialValue但是数组为空，那么此唯一值将被返回并callback不会被执行。</p>
<p>例如下面的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].reduce(<span class="function"><span class="keyword">function</span>(<span class="params">previousValue,currentValue,index,array</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> previousValue + currentValue;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>回调函数被执行了四次，每次的参数和返回值如下表</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">previousValue</th>
<th style="text-align:center">currentValue</th>
<th style="text-align:center">index</th>
<th style="text-align:center">array</th>
<th style="text-align:right">return value</th>
</tr>
</thead>
<tbody>
<tr>
<td>first call</td>
<td style="text-align:center">0</td>
<td style="text-align:center">1</td>
<td style="text-align:center">1</td>
<td style="text-align:center">[0,1,2,3,4]</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td>second call</td>
<td style="text-align:center">1</td>
<td style="text-align:center">2</td>
<td style="text-align:center">2</td>
<td style="text-align:center">[0,1,2,3,4]</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td>third call</td>
<td style="text-align:center">3</td>
<td style="text-align:center">3</td>
<td style="text-align:center">3</td>
<td style="text-align:center">[0,1,2,3,4]</td>
<td style="text-align:right">6</td>
</tr>
<tr>
<td>fourth call</td>
<td style="text-align:center">6</td>
<td style="text-align:center">4</td>
<td style="text-align:center">4</td>
<td style="text-align:center">[0,1,2,3,4]</td>
<td style="text-align:right">10</td>
</tr>
</tbody>
</table>
<p>reduce 的返回值是回调函数的最后一次被调用的返回值10。</p>
<p>如果把初始值作为第二个参数传入reduce，最终返回值变为20，结果如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>].reduce(<span class="function"><span class="keyword">function</span>(<span class="params">previousValue,currentValue,index,array</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> previousValue + currentValue;</div><div class="line">&#125;,<span class="number">10</span>);</div></pre></td></tr></table></figure>
<h2 id="栗子"><a href="#栗子" class="headerlink" title="栗子"></a>栗子</h2><ol>
<li>将数组所有项相加</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> total = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].reduce(<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> a + b;</div><div class="line">&#125;);</div><div class="line"><span class="comment">//total 6</span></div></pre></td></tr></table></figure>
<ol>
<li>将数组扁平化</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> flattened = [[<span class="number">0</span>,<span class="number">1</span>],[<span class="number">2</span>,<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>],[<span class="number">6</span>,<span class="number">7</span>]].reduce(<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> a.concat(b);</div><div class="line">&#125;);</div><div class="line"><span class="comment">// flattened is [0,1,2,3,4,5]</span></div></pre></td></tr></table></figure>
<h2 id="兼容旧环境-Polyfill"><a href="#兼容旧环境-Polyfill" class="headerlink" title="兼容旧环境(Polyfill)"></a>兼容旧环境(Polyfill)</h2><p>Array.prototype.reduce 被添加到ECMA-262标准第5版；因此可能在某些环境中不被支持。可以将下面的代码插入到脚本开头来允许在那些未被原生支持reduce的实现环境中使用它。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(<span class="string">'function'</span> !== <span class="keyword">typeof</span> <span class="built_in">Array</span>.prototype.reduce)&#123;</div><div class="line">    <span class="built_in">Array</span>.prototype.reduce = <span class="function"><span class="keyword">function</span>(<span class="params">callback,opt_initialValue</span>)</span>&#123;</div><div class="line"><span class="meta">        'use strict'</span></div><div class="line">        <span class="keyword">if</span>(<span class="literal">null</span> == <span class="keyword">this</span> || <span class="string">'undefined'</span> === <span class="keyword">typeof</span> <span class="keyword">this</span>)&#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Array.prototype.reduce called on null or undefined'</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(<span class="string">'function'</span> !== <span class="keyword">typeof</span>(callback))&#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(callback + <span class="string">'is not a function'</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">var</span> index, value, length = <span class="keyword">this</span>.length &gt;&gt;&gt; <span class="number">0</span>, isValueSet = <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(<span class="number">1</span>&lt;argument.length)&#123;</div><div class="line">            value = opt_initialValue;</div><div class="line">            isValueSet = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span>(index = <span class="number">0</span>;length &gt; index; ++index)&#123;</div><div class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.hasOwnProperty(index))&#123;</div><div class="line">                <span class="keyword">if</span>(isValueSet)&#123;</div><div class="line">                    value = callback(value,<span class="keyword">this</span>[index],index,<span class="keyword">this</span>);</div><div class="line">                &#125;<span class="keyword">else</span>&#123;</div><div class="line">                    value = <span class="keyword">this</span>[index];</div><div class="line">                    isValueSet = <span class="literal">true</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(!isValueSet)&#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Reduce of empty with no initial value'</span>);</div><div class="line">            <span class="keyword">return</span> value;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/08/es6函数式编程/" itemprop="url">
                  es6函数式编程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-08T21:46:52+08:00" content="2016-05-08">
              2016-05-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/教程/" itemprop="url" rel="index">
                    <span itemprop="name">教程</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/08/es6函数式编程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/08/es6函数式编程/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Intelligence without ambition is a bird without wings.</p>
</blockquote>
<h2 id="什么是函数式编程"><a href="#什么是函数式编程" class="headerlink" title="什么是函数式编程"></a>什么是函数式编程</h2><p>函数式编程是一种编程范式，我们常见的编程范式有命令式编程，函数式编程和逻辑式编程，常见的面向对象编程也是一种命令式编程。函数式编程世界里，函数是一等公民。</p>
<h2 id="函数式编程给我带来的好处"><a href="#函数式编程给我带来的好处" class="headerlink" title="函数式编程给我带来的好处"></a>函数式编程给我带来的好处</h2><p>由于命令式编程语言也可以通过类似函数指针的方式来实现高阶函数，函数式的最主要的好处是不可变性带来的。没有可变的状态，函数就是引用透明的和没有副作用。</p>
<p>好处：函数既不依赖外部的状态也不修改外部的状态，函数调用的结果不依赖调用的时间和位置，这样写的代码容易进行推理，不容易出错。这使得单元测试和调试都更容易。</p>
<ol>
<li>纯函数式</li>
</ol>
<blockquote>
<p>什么是纯函数：相同的参数返回的结果相同，它的执行不依赖于系统的状态<br>函数式编程的核心就是借助形式化数学来描述逻辑：lambda运算。数学家们喜欢将程序描述为数据的变换，这也引入了第一个概念：纯函数。纯函数无副作用，仅仅依赖于函数的输入，并且当输入相同时输出保持一致。  </p>
</blockquote>
<p>1) 非纯净的<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> number = <span class="number">1</span>;</div><div class="line"><span class="keyword">const</span> increment = <span class="function"><span class="params">()</span> =&gt;</span> number + <span class="number">1</span>;</div><div class="line">increment();</div></pre></td></tr></table></figure></p>
<p>2) 纯净的<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> increment = <span class="function"><span class="params">n</span> =&gt;</span> n+<span class="number">1</span>;</div><div class="line">increment(<span class="number">1</span>);</div></pre></td></tr></table></figure></p>
<ol>
<li>高阶函数<br>函数把其他函数当做参数传递使用或者返回一个函数</li>
</ol>
<p>1) 加法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> sum = <span class="function">(<span class="params">x,y</span>) =&gt;</span> x+y;</div><div class="line"><span class="keyword">const</span> calculate = <span class="function">(<span class="params">fn,x,y</span>) =&gt;</span> fn(x,y);</div><div class="line">calculate(sum,<span class="number">1</span>,<span class="number">2</span>);</div></pre></td></tr></table></figure></p>
<p>2) filter<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> students = [</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Tom'</span>, <span class="attr">grade</span>: <span class="number">6</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Tim'</span>, <span class="attr">grade</span>: <span class="number">7</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Bom'</span>, <span class="attr">grade</span>: <span class="number">8</span>&#125;</div><div class="line">];</div><div class="line"><span class="keyword">const</span> isApproved = <span class="function"><span class="params">student</span> =&gt;</span> student.grade &gt;=<span class="number">7</span>;</div><div class="line">students.filter(isApproved);</div></pre></td></tr></table></figure></p>
<p>3) Map<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> byName = <span class="function"><span class="params">obj</span> =&gt;</span> obj.name;</div><div class="line">students.map(byName);</div></pre></td></tr></table></figure></p>
<p>4) 链式<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> students = [</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Tom'</span>, <span class="attr">grade</span>: <span class="number">6</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Tim'</span>, <span class="attr">grade</span>: <span class="number">7</span>&#125;,</div><div class="line">    &#123;<span class="attr">name</span>: <span class="string">'Bom'</span>, <span class="attr">grade</span>: <span class="number">8</span>&#125;</div><div class="line">];</div><div class="line"><span class="keyword">const</span> isApproved = <span class="function"><span class="params">student</span> =&gt;</span> student.grade &gt;= <span class="number">6</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> byName = <span class="function"><span class="params">obj</span> =&gt;</span> obj.name;</div><div class="line"></div><div class="line">students.filter(isApproved).map(byName);</div></pre></td></tr></table></figure></p>
<p>5) Reduce<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> totalGrades = students.reduce(<span class="function">(<span class="params">sum,student</span>) =&gt;</span> sum + student.grade, <span class="number">0</span>);</div><div class="line">totalGrades</div></pre></td></tr></table></figure></p>
<ol>
<li>递归<br>当一个函数调用它自己的时候就创造了一个循环</li>
</ol>
<p>1) 递减<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> countdown = <span class="function"><span class="params">num</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">if</span>(num &gt; <span class="number">0</span>)&#123;</div><div class="line">        <span class="built_in">console</span>.log(num);</div><div class="line">        countdown(num <span class="number">-1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">countdown(<span class="number">5</span>);</div></pre></td></tr></table></figure></p>
<p>2) 阶乘<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> factorial = <span class="function"><span class="params">num</span> =&gt;</span> &#123;</div><div class="line">    <span class="keyword">if</span>(num &lt;= <span class="number">0</span>)&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">return</span> (num * factorial(num - <span class="number">1</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">factorial(<span class="number">5</span>);</div></pre></td></tr></table></figure></p>
<ol>
<li>Functor<br>有map方法的对象。functor的map方法通过map回调函数调用自己的内容，然后返回一个新的functor.</li>
</ol>
<p>1) 给数组所有的元素添加一个值<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> plus1 = <span class="function"><span class="params">num</span> =&gt;</span> num + <span class="number">1</span>;</div><div class="line"><span class="keyword">let</span> numbers = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</div><div class="line">numbers.map(plus1);</div></pre></td></tr></table></figure></p>
<ol>
<li>组合<br>通过组合两个或更多的函数生成一个新的函数</li>
</ol>
<p>1) 组合两个函数生成一个新的函数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> compose = <span class="function">(<span class="params">f,g</span>) =&gt;</span> x =&gt; f(g(x));</div><div class="line"><span class="keyword">const</span> toUpperCase = <span class="function"><span class="params">x</span> =&gt;</span> x.toUpperCase();</div><div class="line"><span class="keyword">const</span> exclaim = <span class="function"><span class="params">x</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;x&#125;</span>!`</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> angry = compose(exclaim,toUpperCase);</div><div class="line"></div><div class="line">angry(<span class="string">"stop this"</span>);</div></pre></td></tr></table></figure></p>
<p>2) 组合三个函数生成一个新的<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> compose = <span class="function">(<span class="params">f,g</span>) =&gt;</span> x =&gt; f(g(x));</div><div class="line"></div><div class="line"><span class="keyword">const</span> toUpperCase = <span class="function"><span class="params">x</span> =&gt;</span> x.toUpperCase();</div><div class="line"><span class="keyword">const</span> exclaim = <span class="function"><span class="params">x</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;x&#125;</span>!`</span>;</div><div class="line"><span class="keyword">const</span> moreExclaim = <span class="function"><span class="params">x</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;x&#125;</span>!!!!!`</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> reallyAngry = compose(exclaim, compose(toUpperCase,moreExclaim));</div><div class="line"></div><div class="line">reallyAngry(<span class="string">"stop this"</span>);</div></pre></td></tr></table></figure></p>
<ol>
<li>解构<br>从数组中提取数据或对象使用一种语法混合数组和对象文本的建设。或“模式匹配”。<br>1) Select from pattern</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> foo = <span class="function"><span class="params">()</span> =&gt;</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</div><div class="line"><span class="keyword">const</span> [a,b] = foo();</div><div class="line"><span class="built_in">console</span>.log(a,b);</div></pre></td></tr></table></figure>
<p>2) 接收rest值<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> [a,...b] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</div><div class="line"><span class="built_in">console</span>.log(a,b)</div></pre></td></tr></table></figure></p>
<p>3) 可选参数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> ajax = <span class="function">(<span class="params">&#123; url = <span class="string">"localhost"</span>, port: p=<span class="number">80</span>&#125;, ...data</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"Url:"</span>, url, <span class="string">"Port:"</span>, p, <span class="string">"Rest:"</span>, data);</div><div class="line"></div><div class="line">ajax(&#123; <span class="attr">url</span>: <span class="string">"someHost"</span> &#125;, <span class="string">"additional"</span>, <span class="string">"data"</span>, <span class="string">"hello"</span>);</div><div class="line"><span class="comment">// Url: someHost Port: 80 Rest: [ 'additional', 'data', 'hello' ]</span></div><div class="line"></div><div class="line">ajax(&#123; &#125;, <span class="string">"additional"</span>, <span class="string">"data"</span>, <span class="string">"hello"</span>);</div><div class="line"><span class="comment">// Url: localhost Port: 80 Rest: [ 'additional', 'data', 'hello' ]</span></div></pre></td></tr></table></figure></p>
<ol>
<li>柯里化<br>一个函数有多个参数，把每个参数通过链式的形式返回下一个函数，知道最后一个返回结果。</li>
</ol>
<p>1) 对象柯里化<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> student = <span class="function"><span class="params">name</span> =&gt;</span> grade =&gt; <span class="string">`Name: <span class="subst">$&#123;name&#125;</span> | Grade: <span class="subst">$&#123;grade&#125;</span>`</span>;</div><div class="line">student(<span class="string">"Matt"</span>)(<span class="number">8</span>);</div><div class="line"><span class="comment">// Name: Matt | Grade: 8</span></div></pre></td></tr></table></figure></p>
<p>2) 加法函数柯里化<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> add = <span class="function"><span class="params">x</span> =&gt;</span> y =&gt; x+y;</div><div class="line"></div><div class="line"><span class="keyword">const</span> increment = add(<span class="number">1</span>);</div><div class="line"><span class="keyword">const</span> addFive = add(<span class="number">5</span>);</div><div class="line"></div><div class="line">increment(<span class="number">3</span>);</div><div class="line"><span class="comment">//4</span></div><div class="line"></div><div class="line">addFive(<span class="number">10</span>);</div><div class="line"><span class="comment">//15</span></div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/04/animation-详解/" itemprop="url">
                  animation-详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-04T16:22:51+08:00" content="2016-04-04">
              2016-04-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/教程/" itemprop="url" rel="index">
                    <span itemprop="name">教程</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/04/animation-详解/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/04/animation-详解/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>A glamorous life is quite different to a life of luxury.</p>
</blockquote>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>animation属性是动画属性的简写，其中包括：</p>
<ul>
<li>animation-name</li>
<li>animation-duration</li>
<li>animation-timing-function</li>
<li>animation-delay</li>
<li>animation-iteration-count</li>
<li>animation-direction</li>
<li>animation-fill-mode</li>
</ul>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><p>animation可以定义多个动画属性，需要用逗号分隔。比如：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">/*一个animation定义的时候*/</div><div class="line">animation: [animation-name] [animation-duration] [animation-timing-function] [animation-delay] [animation-iteration-count] [animation-fill-mode];</div><div class="line">/*多个animation定义的时候*/</div><div class="line">animation: [animation-name] [animation-duration] [animation-timing-function] [animation-delay] [animation-iteration-count] [animation-fill-mode],</div><div class="line">[animation-name] [animation-duration] [animation-timing-function] [animation-delay] [animation-iteration-count] [animation-fill-mode];</div></pre></td></tr></table></figure></p>
<p>其中简写的animation属性用空格分隔，而且他们之间的排序没什么影响，除了animation-duration和animation-delay，他们需要顺序。也就是说当你使用两个time参数的时候，第一个时间指的是animation-duration第二个时间指的是animation-delay。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">animation: bounce <span class="number">0.3</span>s ease-<span class="keyword">in</span>-out <span class="number">1</span>s infinite;</div><div class="line"><span class="comment">/*equivalent to*/</span></div><div class="line">animation-name: bounce;</div><div class="line">animation-duration: <span class="number">0.3</span>s;</div><div class="line">animation-timing-<span class="function"><span class="keyword">function</span>: <span class="title">ease</span>-<span class="title">in</span>-<span class="title">out</span>;</span></div><div class="line"><span class="title">animation</span>-<span class="title">delay</span>: 1<span class="title">s</span>;</div><div class="line"><span class="title">animation</span>-<span class="title">iteration</span>-<span class="title">count</span>: <span class="title">infinite</span>;</div></pre></td></tr></table></figure>
<h2 id="animation-play-state"><a href="#animation-play-state" class="headerlink" title="animation-play-state"></a>animation-play-state</h2><p>animation-play-state属性决定CSS animation是运行还是暂停。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">animation-play-state: running | paused</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="GaoQ" />
          <p class="site-author-name" itemprop="name">GaoQ</p>
          <p class="site-description motion-element" itemprop="description">There are no shortcuts to any place worth going</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">39</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        <div class="links-of-blogroll motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">GaoQ</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"gaoquan"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>

  
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/MathJax.js"></script>
    <script type="text/javascript" src="http://cdn.staticfile.org/mathjax/2.4.0/config/TeX-AMS-MML_HTMLorMML.js"></script>
  


  


</body>
</html>
